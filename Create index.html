<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Marshall Tuner</title>
    <style>
        :root { --gold: #d4af37; --black: #1a1a1a; --green: #00ff00; }
        body { background: #000; color: var(--gold); font-family: "Times New Roman", Times, serif; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }

        /* 1. 还原 Marshall Logo 质感 */
        .marshall-logo {
            font-size: 3.5rem;
            color: #fff;
            font-style: italic;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #444, 4px 4px 8px rgba(0,0,0,0.8);
            letter-spacing: -2px;
        }

        #screen { width: 90vw; height: 30vh; border: 3px solid #333; border-radius: 10px; background: #051005; position: relative; box-shadow: inset 0 0 50px #000; }
        canvas { width: 100%; height: 100%; }

        .controls { width: 85vw; margin-top: 40px; }
        .knob-container { margin-bottom: 35px; }
        .label { font-size: 0.7rem; letter-spacing: 2px; margin-bottom: 15px; display: block; color: #888; }

        /* 2. 在轨道中直接显示目标位置 */
        input[type=range] { 
            width: 100%; -webkit-appearance: none; height: 8px; border-radius: 4px; outline: none;
            /* 利用渐变在特定位置画出金线目标 */
        }
        
        /* Frequency 轨道：在 11% 处标金线 */
        #freq { background: linear-gradient(to right, #333 10%, var(--gold) 11%, var(--gold) 12%, #333 13%); }
        /* Amplitude 轨道：在 80% 处标金线 */
        #amp { background: linear-gradient(to right, #333 79%, var(--gold) 80%, var(--gold) 81%, #333 82%); }

        input[type=range]::-webkit-slider-thumb { 
            -webkit-appearance: none; height: 34px; width: 34px; border-radius: 50%; 
            background: radial-gradient(circle, #eee, var(--gold)); border: 2px solid #000; box-shadow: 0 4px 6px rgba(0,0,0,0.5); margin-top: -13px; 
        }

        #overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: none; background: rgba(0,0,0,0.95); flex-direction: column; 
            align-items: center; justify-content: center; z-index: 100; text-align: center;
        }
        .btn { 
            padding: 20px 50px; border: none; background: var(--gold); color: #000; 
            font-size: 1.2rem; font-weight: bold; border-radius: 5px; cursor: pointer;
            box-shadow: 0 0 20px rgba(212,175,55,0.5);
        }
    </style>
</head>
<body>

    <div class="marshall-logo">Marshall</div>

    <div id="screen">
        <canvas id="osc"></canvas>
        <div id="overlay">
            <h1 style="color:#fff; margin-bottom:10px;">SUCCESS</h1>
            <p style="color:var(--gold); margin-bottom:30px;">SIGNAL SYNCHRONIZED</p>
            <button class="btn" id="playBtn">BIRTHDAY MODE ON</button>
        </div>
    </div>

    <div class="controls">
        <div class="knob-container">
            <span class="label">FREQUENCY (TARGET: 11)</span>
            <input type="range" id="freq" min="0" max="100" value="50">
        </div>
        <div class="knob-container">
            <span class="label">AMPLITUDE (TARGET: 80)</span>
            <input type="range" id="amp" min="0" max="100" value="20">
        </div>
    </div>

    <audio id="bgm" preload="auto">
        <source src="https://www.mboxdrive.com/Happy%20Birthday%20Piano.mp3" type="audio/mpeg">
    </audio>

    <script>
        const canvas = document.getElementById('osc');
        const ctx = canvas.getContext('2d');
        const freqInput = document.getElementById('freq');
        const ampInput = document.getElementById('amp');
        const overlay = document.getElementById('overlay');
        const bgm = document.getElementById('bgm');
        const playBtn = document.getElementById('playBtn');

        let width, height, offset = 0;
        let isUnlocked = false;

        function resize() {
            width = canvas.width = canvas.offsetWidth;
            height = canvas.height = canvas.offsetHeight;
        }
        window.onresize = resize;
        resize();

        // 3. 解决音频播放的关键：必须由用户直接点击触发
        playBtn.addEventListener('click', function() {
            bgm.play();
            playBtn.innerText = "HAPPY BIRTHDAY!";
            playBtn.style.background = "#fff";
            setTimeout(() => {
                alert("礼物已解锁！快去开启你的马歇尔音箱吧！");
            }, 500);
        });

        function draw() {
            ctx.clearRect(0, 0, width, height);
            
            // 绘制绿色网格
            ctx.strokeStyle = '#0a2a0a';
            ctx.lineWidth = 1;
            for(let i=0; i<width; i+=30) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, height); ctx.stroke(); }
            for(let i=0; i<height; i+=30) { ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(width, i); ctx.stroke(); }

            const f = parseInt(freqInput.value);
            const a = parseInt(ampInput.value);

            // 判定逻辑：目标 11 和 80
            const matched = (Math.abs(f - 11) <= 3 && Math.abs(a - 80) <= 3);

            if (matched && !isUnlocked) {
                isUnlocked = true;
                overlay.style.display = 'flex';
            }

            ctx.strokeStyle = matched ? var(--green) : var(--gold);
            ctx.lineWidth = matched ? 4 : 2;
            ctx.beginPath();

            for (let x = 0; x < width; x++) {
                let y = height/2 + Math.sin(x * (f/150) + offset) * (a * height/250);
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            offset += 0.1;
            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>
